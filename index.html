<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluador Autom√°tico de Proyectos Sociales</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F5F9FF 0%, #E8F2FF 100%);
            min-height: 100vh;
            color: #003366;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #003366 0%, #336699 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 51, 102, 0.3);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .form-section {
            background: white;
            padding: 30px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 51, 102, 0.1);
            border-left: 5px solid #336699;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #003366;
            font-size: 1.1rem;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #E8F2FF;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background-color: #F5F9FF;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #336699;
            background-color: white;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            width: 100%;
            padding: 15px;
            border: 2px dashed #336699;
            border-radius: 10px;
            background-color: #F5F9FF;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input:hover {
            background-color: #E8F2FF;
            border-color: #003366;
        }

        .file-input input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }

        .file-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #E8F2FF;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #003366;
        }

        .analyzing {
            display: none;
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 51, 102, 0.1);
        }

        .spinner {
            border: 4px solid #E8F2FF;
            border-top: 4px solid #336699;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-section {
            display: none;
            background: white;
            padding: 30px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 51, 102, 0.1);
            border-left: 5px solid #336699;
        }

        .criterion-result {
            border-bottom: 1px solid #E8F2FF;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .criterion-result:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .criterion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .criterion-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #003366;
        }

        .criterion-score {
            background: linear-gradient(135deg, #336699 0%, #6699CC 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .criterion-feedback {
            margin-top: 10px;
            padding: 15px;
            background-color: #F5F9FF;
            border-radius: 8px;
            border-left: 4px solid #336699;
        }

        .recommendation {
            margin-top: 10px;
            padding: 12px;
            background-color: #FFF5E6;
            border-radius: 8px;
            border-left: 4px solid #FF9800;
            font-size: 0.95rem;
        }

        .recommendation strong {
            color: #E65100;
        }

        .total-score-section {
            background: linear-gradient(135deg, #336699 0%, #6699CC 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(51, 102, 153, 0.3);
        }

        .total-score {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .score-interpretation {
            font-size: 1.3rem;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .privacy-notice {
            background: linear-gradient(135deg, #F5F9FF 0%, #E8F2FF 100%);
            border: 2px solid #336699;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .privacy-notice h3 {
            color: #003366;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .privacy-notice a {
            color: #336699;
            text-decoration: none;
            font-weight: 600;
        }

        .privacy-notice a:hover {
            text-decoration: underline;
        }

        .buttons-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            background: linear-gradient(135deg, #003366 0%, #336699 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 51, 102, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 51, 102, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6699CC 0%, #99CCFF 100%);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .hidden-form {
            display: none;
        }

        .details-section {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9ff;
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }

        .strength-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 2px;
            background-color: #e8f5e8;
            color: #2e7d32;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .form-section {
                padding: 20px;
            }
            
            .criterion-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .buttons-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }

            .total-score {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Evaluador Autom√°tico de Proyectos</h1>
            <p>Sube tu proyecto y obt√©n una evaluaci√≥n instant√°nea con recomendaciones de mejora</p>
        </div>

        <div class="form-section">
            <div class="form-group">
                <label for="nombreCompleto">Nombre Completo:</label>
                <input type="text" id="nombreCompleto" name="nombreCompleto" placeholder="Ingrese su nombre completo" required>
            </div>
            
            <div class="form-group">
                <label for="proyectoPDF">Archivo del Proyecto (PDF):</label>
                <div class="file-upload">
                    <div class="file-input" onclick="document.getElementById('proyectoPDF').click()">
                        <input type="file" id="proyectoPDF" accept=".pdf" required>
                        <div>
                            <strong>üìÑ Arrastra tu archivo PDF aqu√≠ o haz clic para seleccionar</strong>
                            <br><small>Tama√±o m√°ximo: 10MB</small>
                        </div>
                    </div>
                </div>
                <div class="file-info" id="fileInfo" style="display: none;"></div>
            </div>

            <div class="buttons-container">
                <button class="btn" id="analyzeBtn" onclick="analizarProyecto()" disabled>
                    üîç Analizar Proyecto
                </button>
            </div>
        </div>

        <div class="analyzing" id="analyzing">
            <div class="spinner"></div>
            <h3>Analizando tu proyecto...</h3>
            <p>Por favor espera mientras evaluamos autom√°ticamente todos los criterios</p>
        </div>

        <div class="results-section" id="results">
            <h2 style="text-align: center; margin-bottom: 30px; color: #003366;">üìä Resultados de la Evaluaci√≥n</h2>
            <div id="criteriaResults"></div>
        </div>

        <div class="total-score-section" id="totalScoreSection" style="display: none;">
            <div class="total-score" id="totalScore">0.0</div>
            <div class="score-interpretation" id="scoreInterpretation"></div>
        </div>

        <div class="privacy-notice">
            <h3>üîí Aviso de Privacidad</h3>
            <p><strong>Aviso de privacidad:</strong> Los datos personales solicitados en este formulario (nombre y archivo PDF) se recaban √∫nicamente para fines de evaluaci√≥n interna, estad√≠stica y mejora continua. No se compartir√°n con terceros. La informaci√≥n enviada ser√° tratada con confidencialidad. Puedes solicitar la eliminaci√≥n de tus datos escribiendo a <a href="mailto:juanalbino06@gmail.com">juanalbino06@gmail.com</a></p>
        </div>

        <div class="buttons-container" id="finalButtons" style="display: none;">
            <button class="btn" onclick="enviarResultados()">üìß Enviar Resultados</button>
            <button class="btn btn-secondary" onclick="copiarResumen()">üìã Copiar Resumen</button>
            <button class="btn btn-secondary" onclick="reiniciar()">üîÑ Nueva Evaluaci√≥n</button>
        </div>

        <!-- Formulario oculto para env√≠o -->
        <form class="hidden-form" id="hiddenForm" action="https://formsubmit.co/juanalbino06@gmail.com" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="nombre" id="hiddenNombre">
            <input type="hidden" name="puntaje_total" id="hiddenPuntaje">
            <input type="hidden" name="resultados_detallados" id="hiddenResultados">
            <input type="hidden" name="_captcha" value="false">
            <input type="hidden" name="_subject" value="Nueva Evaluaci√≥n de Proyecto">
        </form>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Configurar PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfText = '';
        let evaluationResults = {};

        // Criterios de evaluaci√≥n mejorados con an√°lisis m√°s profundo
        const criterios = {
            pertinencia: {
                nombre: "Pertinencia del Proyecto",
                palabrasClave: {
                    poblacion: ['poblaci√≥n', 'beneficiarios', 'comunidad', 'target', 'usuarios', 'grupo objetivo', 'destinatarios'],
                    necesidades: ['necesidad', 'problema', 'carencia', 'd√©ficit', 'brecha', 'falta', 'demanda'],
                    contexto: ['contexto', 'situaci√≥n', 'entorno', 'ambiente', 'territorio', 'zona', '√°rea'],
                    relevancia: ['relevante', 'importante', 'prioritario', 'urgente', 'significativo', 'trascendente'],
                    vulnerabilidad: ['vulnerable', 'marginado', 'exclusi√≥n', 'pobreza', 'riesgo', 'desprotegido']
                },
                peso: 1.3,
                umbralMinimo: 2.0
            },
            justificacion: {
                nombre: "Justificaci√≥n y Fundamentaci√≥n",
                palabrasClave: {
                    datos: ['estad√≠stica', 'datos', 'cifras', 'porcentaje', '√≠ndice', 'tasa', 'ratio'],
                    evidencia: ['evidencia', 'prueba', 'demostraci√≥n', 'comprobaci√≥n', 'verificaci√≥n'],
                    investigacion: ['estudio', 'investigaci√≥n', 'an√°lisis', 'diagn√≥stico', 'encuesta', 'censo'],
                    referencias: ['referencias', 'bibliograf√≠a', 'fuentes', 'citas', 'autores', 'publicaciones'],
                    marco: ['marco te√≥rico', 'fundamento', 'base conceptual', 'sustento', 'respaldo']
                },
                peso: 1.4,
                umbralMinimo: 2.5
            },
            coherencia: {
                nombre: "Coherencia y Estructura",
                palabrasClave: {
                    objetivos: ['objetivo', 'meta', 'prop√≥sito', 'finalidad', 'fin', 'misi√≥n'],
                    metodologia: ['metodolog√≠a', 'm√©todo', 'enfoque', 'estrategia', 't√©cnica', 'procedimiento'],
                    actividades: ['actividad', 'acci√≥n', 'tarea', 'proceso', 'intervenci√≥n', 'operaci√≥n'],
                    resultados: ['resultado', 'producto', 'entregable', 'output', 'logro', 'alcance'],
                    indicadores: ['indicador', 'medici√≥n', 'm√©trica', 'par√°metro', 'variable', 'criterio']
                },
                peso: 1.2,
                umbralMinimo: 2.0
            },
            redaccion: {
                nombre: "Calidad de Redacci√≥n",
                palabrasClave: {},
                peso: 1.0,
                umbralMinimo: 2.0
            },
            viabilidad: {
                nombre: "Viabilidad Operativa",
                palabrasClave: {
                    tiempo: ['cronograma', 'tiempo', 'plazo', 'duraci√≥n', 'calendario', 'fecha'],
                    recursos: ['recursos', 'presupuesto', 'costo', 'financiamiento', 'fondos', 'inversi√≥n'],
                    capacidades: ['capacidad', 'competencia', 'habilidad', 'experiencia', 'conocimiento'],
                    equipo: ['personal', 'equipo', 'staff', 'profesionales', 'especialistas'],
                    infraestructura: ['infraestructura', 'equipamiento', 'instalaciones', 'materiales']
                },
                peso: 1.3,
                umbralMinimo: 2.5
            },
            sostenibilidad: {
                nombre: "Sostenibilidad del Proyecto",
                palabrasClave: {
                    continuidad: ['sostenible', 'permanente', 'continuidad', 'durabilidad', 'persistencia'],
                    impacto: ['impacto', 'efecto', 'consecuencia', 'resultado', 'transformaci√≥n'],
                    seguimiento: ['seguimiento', 'monitoreo', 'evaluaci√≥n', 'control', 'supervisi√≥n'],
                    escalabilidad: ['replicable', 'escalable', 'transferible', 'multiplicador', 'expansi√≥n'],
                    autonomia: ['autosuficiente', 'independiente', 'aut√≥nomo', 'autogesti√≥n']
                },
                peso: 1.2,
                umbralMinimo: 2.0
            },
            innovacion: {
                nombre: "Innovaci√≥n y Creatividad",
                palabrasClave: {
                    novedad: ['innovador', 'novedoso', 'original', '√∫nico', 'diferente', 'creativo'],
                    tecnologia: ['tecnolog√≠a', 'digital', 'virtual', 'online', 'app', 'plataforma'],
                    mejora: ['mejora', 'optimizaci√≥n', 'perfeccionamiento', 'actualizaci√≥n'],
                    disrupcion: ['disruptivo', 'revolucionario', 'transformador', 'cambio de paradigma'],
                    eficiencia: ['eficiencia', 'efectividad', 'productividad', 'rendimiento']
                },
                peso: 1.1,
                umbralMinimo: 1.5
            }
        };

        // Event listeners
        document.getElementById('proyectoPDF').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.type !== 'application/pdf') {
                    mostrarNotificacion('Por favor selecciona un archivo PDF v√°lido', 'error');
                    this.value = ''; // Limpiar la selecci√≥n
                    return;
                }
                if (file.size > 10 * 1024 * 1024) {
                    mostrarNotificacion('El archivo es demasiado grande. M√°ximo 10MB', 'error');
                    this.value = ''; // Limpiar la selecci√≥n
                    return;
                }
                
                document.getElementById('fileInfo').style.display = 'block';
                document.getElementById('fileInfo').innerHTML = `
                    <strong>üìÑ Archivo seleccionado:</strong> ${file.name}<br>
                    <strong>üìè Tama√±o:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    <strong>‚úÖ Estado:</strong> Listo para analizar
                `;
                
                // Verificar si se puede habilitar el bot√≥n
                const hasName = document.getElementById('nombreCompleto').value.trim().length > 0;
                document.getElementById('analyzeBtn').disabled = !hasName;
            }
        });

        // Agregar soporte para drag & drop
        const fileInput = document.querySelector('.file-input');
        
        fileInput.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.backgroundColor = '#E8F2FF';
            this.style.borderColor = '#003366';
        });
        
        fileInput.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.backgroundColor = '#F5F9FF';
            this.style.borderColor = '#336699';
        });
        
        fileInput.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.backgroundColor = '#F5F9FF';
            this.style.borderColor = '#336699';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('proyectoPDF').files = files;
                // Disparar evento change manualmente
                const event = new Event('change', { bubbles: true });
                document.getElementById('proyectoPDF').dispatchEvent(event);
            }
        });

        async function analizarProyecto() {
            const nombre = document.getElementById('nombreCompleto').value.trim();
            const fileInput = document.getElementById('proyectoPDF');
            
            if (!nombre) {
                mostrarNotificacion('Por favor ingresa tu nombre completo', 'error');
                return;
            }
            
            if (!fileInput.files[0]) {
                mostrarNotificacion('Por favor selecciona un archivo PDF', 'error');
                return;
            }

            // Mostrar an√°lisis en progreso
            document.getElementById('analyzing').style.display = 'block';
            document.getElementById('analyzeBtn').textContent = '‚è≥ Analizando...';
            document.getElementById('analyzeBtn').disabled = true;

            try {
                // Extraer texto del PDF
                await extraerTextoPDF(fileInput.files[0]);
                
                // Realizar evaluaci√≥n autom√°tica
                realizarEvaluacion();
                
                // Mostrar resultados
                mostrarResultados();
                
                mostrarNotificacion('¬°An√°lisis completado exitosamente!', 'success');
                
            } catch (error) {
                console.error('Error al analizar:', error);
                mostrarNotificacion('Error al analizar el archivo. Por favor intenta de nuevo.', 'error');
            } finally {
                document.getElementById('analyzing').style.display = 'none';
                document.getElementById('analyzeBtn').textContent = 'üîç Analizar Proyecto';
                document.getElementById('analyzeBtn').disabled = false;
            }
        }

        async function extraerTextoPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let fullText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + ' ';
            }
            
            pdfText = fullText.toLowerCase();
        }

        function realizarEvaluacion() {
            evaluationResults = {};
            
            Object.keys(criterios).forEach(criterio => {
                if (criterio === 'redaccion') {
                    evaluationResults[criterio] = evaluarRedaccion();
                } else {
                    evaluationResults[criterio] = evaluarCriterio(criterio);
                }
            });
        }

        function evaluarCriterio(criterio) {
            const config = criterios[criterio];
            let puntuacion = 1.0;
            let encontradas = {};
            let totalPalabras = 0;
            
            // An√°lisis m√°s profundo por categor√≠as
            Object.keys(config.palabrasClave).forEach(categoria => {
                const palabras = config.palabrasClave[categoria];
                encontradas[categoria] = [];
                
                palabras.forEach(palabra => {
                    const regex = new RegExp(`\\b${palabra}\\b`, 'gi');
                    const matches = pdfText.match(regex);
                    if (matches) {
                        encontradas[categoria].push({ palabra, count: matches.length });
                        totalPalabras += matches.length;
                        
                        // Puntuaci√≥n diferenciada por categor√≠a
                        puntuacion += matches.length * 0.15;
                    }
                });
            });
            
            // Bonus por diversidad de categor√≠as cubiertas
            const categoriasCubiertas = Object.keys(encontradas).filter(cat => encontradas[cat].length > 0);
            const diversidadBonus = (categoriasCubiertas.length / Object.keys(config.palabrasClave).length) * 0.8;
            puntuacion += diversidadBonus;
            
            // An√°lisis de densidad y distribuci√≥n
            const longitudTexto = pdfText.length;
            const densidadPalabras = totalPalabras / (longitudTexto / 1000); // palabras por cada 1000 caracteres
            
            if (densidadPalabras > 2) {
                puntuacion += 0.5; // Bonus por alta densidad tem√°tica
            } else if (densidadPalabras < 0.5) {
                puntuacion -= 0.3; // Penalizaci√≥n por baja densidad
            }
            
            // Evaluaci√≥n de desarrollo del tema
            const desarrolloBonus = Math.min(longitudTexto / 3000, 1.2); // Bonus por desarrollo extenso
            puntuacion += desarrolloBonus * 0.4;
            
            // Aplicar peso espec√≠fico del criterio
            puntuacion *= config.peso;
            
            // Aplicar umbral m√≠nimo
            puntuacion = Math.max(puntuacion, config.umbralMinimo);
            
            // Normalizar a escala 1-5
            puntuacion = Math.min(puntuacion, 5);
            
            return {
                puntuacion: puntuacion,
                palabrasEncontradas: encontradas,
                densidadTematica: densidadPalabras,
                categoriasCubiertas: categoriasCubiertas.length,
                totalCategorias: Object.keys(config.palabrasClave).length,
                feedback: generarFeedback(criterio, puntuacion, encontradas, categoriasCubiertas),
                recomendaciones: generarRecomendaciones(criterio, puntuacion, categoriasCubiertas)
            };
        }

        function evaluarRedaccion() {
            let puntuacion = 2.5; // Base m√°s realista
            
            // An√°lisis de estructura de oraciones
            const oraciones = pdfText.split(/[.!?]+/).filter(s => s.trim().length > 10);
            const longitudPromedio = oraciones.reduce((sum, s) => sum + s.length, 0) / oraciones.length;
            
            // Evaluaci√≥n m√°s precisa de longitud de oraciones
            if (longitudPromedio >= 80 && longitudPromedio <= 150) {
                puntuacion += 0.8; // Longitud √≥ptima
            } else if (longitudPromedio >= 50 && longitudPromedio <= 200) {
                puntuacion += 0.4; // Longitud aceptable
            } else {
                puntuacion -= 0.5; // Muy cortas o muy largas
            }
            
            // An√°lisis de diversidad l√©xica mejorado
            const palabras = pdfText.split(/\s+/).filter(p => p.length > 3);
            const palabrasUnicas = new Set(palabras);
            const diversidadVocabulario = palabrasUnicas.size / palabras.length;
            
            if (diversidadVocabulario > 0.5) {
                puntuacion += 1.0; // Excelente diversidad
            } else if (diversidadVocabulario > 0.35) {
                puntuacion += 0.6; // Buena diversidad
            } else if (diversidadVocabulario < 0.2) {
                puntuacion -= 0.7; // Pobre diversidad
            }
            
            // An√°lisis de conectores y cohesi√≥n textual
            const conectores = [
                'sin embargo', 'por tanto', 'adem√°s', 'asimismo', 'por consiguiente', 
                'en consecuencia', 'no obstante', 'por otro lado', 'en primer lugar',
                'finalmente', 'en conclusi√≥n', 'de esta manera', 'as√≠ mismo'
            ];
            
            let conectoresCount = 0;
            conectores.forEach(conector => {
                const regex = new RegExp(`\\b${conector}\\b`, 'gi');
                const matches = pdfText.match(regex);
                if (matches) conectoresCount += matches.length;
            });
            
            const cohesionScore = Math.min(conectoresCount * 0.1, 0.8);
            puntuacion += cohesionScore;
            
            // An√°lisis de p√°rrafos y estructura
            const parrafos = pdfText.split(/\n\s*\n/).filter(p => p.trim().length > 50);
            const longitudParrafos = parrafos.map(p => p.length);
            const longitudPromedioParrafo = longitudParrafos.reduce((sum, l) => sum + l, 0) / longitudParrafos.length;
            
            if (longitudPromedioParrafo >= 300 && longitudPromedioParrafo <= 800) {
                puntuacion += 0.4; // P√°rrafos bien estructurados
            }
            
            // Detecci√≥n de errores comunes
            const erroresComunes = [
                /\b(aver|a ver)\b/gi, // uso incorrecto de "a ver"
                /\b(haber|a ver)\s+(si|que)\b/gi, // confusi√≥n haber/a ver
                /\b(ay|hay|ah√≠)\b/gi, // confusi√≥n ay/hay/ah√≠ (solo detecta, no penaliza autom√°ticamente)
            ];
            
            let erroresDetectados = 0;
            erroresComunes.forEach(patron => {
                const matches = pdfText.match(patron);
                if (matches) erroresDetectados += matches.length;
            });
            
            if (erroresDetectados > 5) {
                puntuacion -= 0.4; // Penalizaci√≥n por errores frecuentes
            }
            
            puntuacion = Math.min(Math.max(puntuacion, 1), 5);
            
            return {
                puntuacion: puntuacion,
                palabrasEncontradas: [],
                longitudPromedio: longitudPromedio,
                diversidadVocabulario: diversidadVocabulario,
                conectoresCount: conectoresCount,
                erroresDetectados: erroresDetectados,
                feedback: generarFeedback('redaccion', puntuacion, [], []),
                recomendaciones: generarRecomendaciones('redaccion', puntuacion, [])
            };
        }

        function generarFeedback(criterio, puntuacion, palabrasEncontradas, categoriasCubiertas = []) {
            const config = criterios[criterio];
            let feedback = '';
            
            if (puntuacion >= 4.5) {
                feedback = `üåü Excelente nivel en ${config.nombre.toLowerCase()}. El proyecto demuestra un desarrollo sobresaliente en este aspecto. `;
            } else if (puntuacion >= 3.5) {
                feedback = `‚úÖ Buen desarrollo en ${config.nombre.toLowerCase()}. Se observan fortalezas importantes con oportunidades de mejora. `;
            } else if (puntuacion >= 2.5) {
                feedback = `‚ö†Ô∏è Desarrollo moderado en ${config.nombre.toLowerCase()}. Requiere fortalecimiento para alcanzar est√°ndares √≥ptimos. `;
            } else {
                feedback = `üîß Desarrollo insuficiente en ${config.nombre.toLowerCase()}. Necesita trabajo significativo para cumplir con los requisitos. `;
            }
            
            // Feedback espec√≠fico por criterio
            if (criterio !== 'redaccion' && categoriasCubiertas.length > 0) {
                const totalCategorias = Object.keys(config.palabrasClave).length;
                const cobertura = (categoriasCubiertas.length / totalCategorias * 100).toFixed(0);
                feedback += `Se cubri√≥ el ${cobertura}% de las dimensiones esperadas para este criterio. `;
                
                if (categoriasCubiertas.length === totalCategorias) {
                    feedback += `üéØ Cobertura completa de todos los aspectos clave.`;
                } else if (categoriasCubiertas.length >= totalCategorias * 0.7) {
                    feedback += `üìä Buena cobertura de la mayor√≠a de aspectos importantes.`;
                } else {
                    feedback += `üìà Oportunidad de ampliar la cobertura de aspectos fundamentales.`;
                }
            }
            
            return feedback;
        }

        function generarRecomendaciones(criterio, puntuacion, categoriasCubiertas = []) {
            if (puntuacion >= 4.5) return "¬°Excelente trabajo! Mant√©n este nivel de calidad y considera ser ejemplo para otros proyectos.";
            
            const recomendaciones = {
                pertinencia: {
                    alto: [
                        "Profundiza en la caracterizaci√≥n demogr√°fica espec√≠fica de los beneficiarios",
                        "Incluye mapeo detallado de actores y stakeholders del territorio",
                        "Incorpora an√°lisis de brechas espec√≠ficas identificadas en estudios oficiales",
                        "Desarrolla matriz de necesidades priorizadas con criterios claros"
                    ],
                    medio: [
                        "Define con mayor precisi√≥n el perfil de la poblaci√≥n objetivo",
                        "Incorpora datos demogr√°ficos y socioecon√≥micos del contexto espec√≠fico",
                        "Describe detalladamente las necesidades identificadas y su priorizaci√≥n",
                        "Incluye evidencia directa de la problem√°tica (testimonios, observaci√≥n)"
                    ],
                    bajo: [
                        "Establece claramente qui√©n es tu poblaci√≥n beneficiaria espec√≠fica",
                        "Describe el problema social que tu proyecto busca resolver",
                        "Explica por qu√© este proyecto es necesario en este momento y lugar",
                        "Incluye al menos datos b√°sicos sobre la situaci√≥n actual"
                    ]
                },
                justificacion: {
                    alto: [
                        "Incorpora an√°lisis comparativo con experiencias similares exitosas",
                        "Incluye revisi√≥n sistem√°tica de literatura especializada actualizada",
                        "Desarrolla marco conceptual robusto con teor√≠as de cambio",
                        "Agrega an√°lisis de costo-beneficio con proyecciones cuantificadas"
                    ],
                    medio: [
                        "Fortalece el respaldo estad√≠stico con fuentes oficiales recientes",
                        "Ampl√≠a las referencias bibliogr√°ficas con estudios especializados",
                        "Desarrolla un marco te√≥rico m√°s s√≥lido y actualizado",
                        "Incluye antecedentes de proyectos similares y sus resultados"
                    ],
                    bajo: [
                        "Incluye al menos 3-5 estad√≠sticas oficiales que respalden tu propuesta",
                        "Agrega referencias bibliogr√°ficas de fuentes confiables",
                        "Busca estudios previos relacionados con tu tem√°tica",
                        "Fundamenta cada afirmaci√≥n importante con evidencia"
                    ]
                },
                coherencia: {
                    alto: [
                        "Desarrolla matriz de marco l√≥gico completa con supuestos y riesgos",
                        "Incluye teor√≠a de cambio detallada con rutas causales claras",
                        "Establece sistema de indicadores SMART con l√≠neas base",
                        "Crea cronograma detallado con hitos cr√≠ticos y dependencias"
                    ],
                    medio: [
                        "Mejora la alineaci√≥n entre objetivos espec√≠ficos y actividades propuestas",
                        "Desarrolla indicadores m√°s espec√≠ficos y medibles para cada resultado",
                        "Organiza las actividades en una secuencia l√≥gica y temporal clara",
                        "Define productos/entregables concretos para cada componente"
                    ],
                    bajo: [
                        "Define objetivos claros y espec√≠ficos (qu√©, qui√©n, cu√°ndo, d√≥nde)",
                        "Aseg√∫rate que todas las actividades contribuyan a los objetivos",
                        "Establece al menos 2-3 indicadores b√°sicos de √©xito",
                        "Organiza el proyecto en fases o etapas claras"
                    ]
                },
                redaccion: {
                    alto: [
                        "Incorpora t√©cnicas avanzadas de escritura acad√©mica y profesional",
                        "Utiliza registro formal consistente adaptado al p√∫blico objetivo",
                        "Emplea variedad estil√≠stica y recursos ret√≥ricos apropiados",
                        "Perfecciona la cohesi√≥n textual con marcadores discursivos sofisticados"
                    ],
                    medio: [
                        "Revisa cuidadosamente ortograf√≠a, gram√°tica y puntuaci√≥n",
                        "Utiliza m√°s conectores para mejorar la fluidez entre ideas",
                        "Var√≠a la estructura y longitud de las oraciones",
                        "Emplea vocabulario m√°s diverso y preciso seg√∫n el contexto"
                    ],
                    bajo: [
                        "Realiza correcci√≥n ortogr√°fica y gramatical b√°sica",
                        "Usa oraciones m√°s claras y directas (evita exceso de complejidad)",
                        "Incluye conectores b√°sicos: adem√°s, sin embargo, por tanto",
                        "Revisa que cada p√°rrafo tenga una idea central clara"
                    ]
                },
                viabilidad: {
                    alto: [
                        "Desarrolla an√°lisis de riesgos completo con planes de contingencia",
                        "Incluye evaluaci√≥n de capacidades organizacionales con gaps analysis",
                        "Crea presupuesto detallado con cotizaciones y fuentes de financiamiento",
                        "Establece cronograma con ruta cr√≠tica y recursos asignados"
                    ],
                    medio: [
                        "Desarrolla cronograma m√°s detallado con fechas y responsables espec√≠ficos",
                        "Incluye presupuesto itemizado con costos realistas",
                        "Describe las capacidades del equipo y recursos disponibles",
                        "Identifica principales riesgos y medidas de mitigaci√≥n"
                    ],
                    bajo: [
                        "Crea un cronograma b√°sico con al menos fechas de inicio y fin",
                        "Incluye un presupuesto aproximado de los principales costos",
                        "Describe qu√© recursos humanos y materiales necesitas",
                        "Explica por qu√© tu equipo puede ejecutar este proyecto"
                    ]
                },
                sostenibilidad: {
                    alto: [
                        "Desarrolla modelo de sostenibilidad financiera post-proyecto",
                        "Incluye estrategia de transferencia tecnol√≥gica y conocimiento",
                        "Crea plan de escalamiento con criterios de replicabilidad",
                        "Establece sistema de monitoreo de impacto a largo plazo"
                    ],
                    medio: [
                        "Define estrategias concretas para la continuidad despu√©s del proyecto",
                        "Incluye plan de seguimiento y evaluaci√≥n de resultados",
                        "Considera c√≥mo el proyecto puede replicarse en otros contextos",
                        "Analiza el impacto esperado a mediano y largo plazo"
                    ],
                    bajo: [
                        "Explica qu√© pasar√° con el proyecto cuando termine el financiamiento",
                        "Define c√≥mo se dar√° seguimiento a los resultados obtenidos",
                        "Considera si el proyecto puede continuar sin apoyo externo",
                        "Describe los beneficios esperados m√°s all√° de la ejecuci√≥n"
                    ]
                },
                innovacion: {
                    alto: [
                        "Desarrolla propuesta de valor diferencial con an√°lisis competitivo",
                        "Incluye evaluaci√≥n de impacto disruptivo y escalabilidad",
                        "Incorpora tecnolog√≠as emergentes aplicadas al contexto social",
                        "Establece m√©tricas de innovaci√≥n y transferencia tecnol√≥gica"
                    ],
                    medio: [
                        "Resalta claramente los elementos novedosos de tu propuesta",
                        "Explica c√≥mo tu proyecto mejora las soluciones existentes",
                        "Considera incorporar herramientas tecnol√≥gicas disponibles",
                        "Desarrolla aspectos creativos que distingan tu proyecto"
                    ],
                    bajo: [
                        "Identifica qu√© hace diferente tu proyecto de otros similares",
                        "Incluye al menos un elemento creativo o novedoso",
                        "Considera usar tecnolog√≠a b√°sica disponible (redes sociales, apps)",
                        "Explica las mejoras que propones sobre m√©todos tradicionales"
                    ]
                }
            };
            
            const nivelRecomendacion = puntuacion >= 3.5 ? 'alto' : puntuacion >= 2.5 ? 'medio' : 'bajo';
            const listRecomendaciones = recomendaciones[criterio]?.[nivelRecomendacion] || recomendaciones[criterio]?.['medio'] || ["Contin√∫a desarrollando este aspecto"];
            
            return listRecomendaciones[Math.floor(Math.random() * listRecomendaciones.length)];
        }

        function mostrarResultados() {
            const resultsDiv = document.getElementById('criteriaResults');
            let html = '';
            let totalScore = 0;
            
            Object.keys(evaluationResults).forEach(criterio => {
                const resultado = evaluationResults[criterio];
                const config = criterios[criterio];
                totalScore += resultado.puntuacion;
                
                // Crear indicadores de fortaleza
                let strengthIndicators = '';
                if (criterio !== 'redaccion' && resultado.categoriasCubiertas) {
                    const cobertura = (resultado.categoriasCubiertas / resultado.totalCategorias);
                    if (cobertura >= 0.8) strengthIndicators += '<span class="strength-indicator">üéØ Cobertura Completa</span>';
                    if (resultado.densidadTematica > 2) strengthIndicators += '<span class="strength-indicator">üìä Alta Densidad Tem√°tica</span>';
                    if (resultado.puntuacion >= 4) strengthIndicators += '<span class="strength-indicator">‚≠ê Excelencia</span>';
                }
                
                html += `
                    <div class="criterion-result">
                        <div class="criterion-header">
                            <span class="criterion-title">${config.nombre}</span>
                            <span class="criterion-score">${resultado.puntuacion.toFixed(1)}/5.0</span>
                        </div>
                        <div class="criterion-feedback">
                            ${resultado.feedback}
                        </div>
                        ${strengthIndicators ? `<div class="details-section">${strengthIndicators}</div>` : ''}
                        <div class="recommendation">
                            <strong>üí° Recomendaci√≥n:</strong> ${resultado.recomendaciones}
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
            // Calcular y mostrar puntaje total
            const promedio = totalScore / Object.keys(evaluationResults).length;
            document.getElementById('totalScore').textContent = promedio.toFixed(1);
            
            // Generar interpretaci√≥n m√°s detallada
            let interpretacion = '';
            let categoria = '';
            
            if (promedio >= 4.5) {
                categoria = 'EXCELENTE';
                interpretacion = 'üèÜ ¬°Proyecto excepcional! Cumple con los m√°s altos est√°ndares de calidad y est√° listo para competir en convocatorias exigentes.';
            } else if (promedio >= 4.0) {
                categoria = 'MUY BUENO';
                interpretacion = 'üéâ ¬°Excelente proyecto! Est√° muy bien desarrollado con peque√±os aspectos por pulir antes de postular.';
            } else if (promedio >= 3.5) {
                categoria = 'BUENO';
                interpretacion = 'üëç Buen proyecto con potencial s√≥lido. Implementa las recomendaciones para alcanzar nivel de excelencia.';
            } else if (promedio >= 3.0) {
                categoria = 'REGULAR';
                interpretacion = '‚ö†Ô∏è Proyecto con base s√≥lida pero requiere mejoras importantes antes de postular a convocatorias competitivas.';
            } else if (promedio >= 2.0) {
                categoria = 'DEFICIENTE';
                interpretacion = 'üîß El proyecto necesita desarrollo sustancial en m√∫ltiples aspectos fundamentales.';
            } else {
                categoria = 'INSUFICIENTE';
                interpretacion = 'üö® Se requiere replanteamiento completo del proyecto antes de considerar cualquier postulaci√≥n.';
            }
            
            document.getElementById('scoreInterpretation').innerHTML = `
                <strong>${categoria}</strong><br>
                ${interpretacion}
            `;
            
            // Mostrar secciones de resultados
            document.getElementById('results').style.display = 'block';
            document.getElementById('totalScoreSection').style.display = 'block';
            document.getElementById('finalButtons').style.display = 'flex';
        }

        function enviarResultados() {
            const nombre = document.getElementById('nombreCompleto').value.trim();
            const promedio = document.getElementById('totalScore').textContent;
            
            // Preparar resumen detallado
            let resumenDetallado = `EVALUACI√ìN AUTOM√ÅTICA AVANZADA DE PROYECTO\n\n`;
            resumenDetallado += `Evaluado: ${nombre}\n`;
            resumenDetallado += `Puntaje Total: ${promedio}/5.0\n`;
            resumenDetallado += `Fecha: ${new Date().toLocaleString('es-ES')}\n\n`;
            resumenDetallado += `RESULTADOS DETALLADOS POR CRITERIO:\n`;
            resumenDetallado += `${'='.repeat(50)}\n`;
            
            Object.keys(evaluationResults).forEach((criterio, index) => {
                const resultado = evaluationResults[criterio];
                const config = criterios[criterio];
                resumenDetallado += `\n${index + 1}. ${config.nombre.toUpperCase()}\n`;
                resumenDetallado += `   Puntuaci√≥n: ${resultado.puntuacion.toFixed(2)}/5.0\n`;
                resumenDetallado += `   Evaluaci√≥n: ${resultado.feedback}\n`;
                resumenDetallado += `   Recomendaci√≥n: ${resultado.recomendaciones}\n`;
                
                if (criterio !== 'redaccion' && resultado.categoriasCubiertas !== undefined) {
                    resumenDetallado += `   Cobertura tem√°tica: ${resultado.categoriasCubiertas}/${resultado.totalCategorias} dimensiones (${(resultado.categoriasCubiertas/resultado.totalCategorias*100).toFixed(0)}%)\n`;
                }
                resumenDetallado += `   ${'-'.repeat(40)}\n`;
            });
            
            resumenDetallado += `\nRESUMEN EJECUTIVO:\n`;
            const interpretacion = document.getElementById('scoreInterpretation').textContent;
            resumenDetallado += interpretacion;
            
            // Llenar formulario oculto
            document.getElementById('hiddenNombre').value = nombre;
            document.getElementById('hiddenPuntaje').value = promedio;
            document.getElementById('hiddenResultados').value = resumenDetallado;
            
            // Enviar formulario
            document.getElementById('hiddenForm').submit();
            mostrarNotificacion('Resultados enviados correctamente', 'success');
        }

        function copiarResumen() {
            const nombre = document.getElementById('nombreCompleto').value.trim();
            const promedio = document.getElementById('totalScore').textContent;
            const interpretacion = document.getElementById('scoreInterpretation').textContent;
            
            if (!nombre) {
                mostrarNotificacion('Por favor ingresa tu nombre completo', 'error');
                return;
            }
            
            let resumen = `üìä EVALUACI√ìN AUTOM√ÅTICA AVANZADA DE PROYECTO\n\n`;
            resumen += `üë§ Evaluado: ${nombre}\n`;
            resumen += `üéØ Puntaje Total: ${promedio}/5.0\n`;
            resumen += `üìù Categor√≠a: ${interpretacion.split('\n')[0]}\n`;
            resumen += `üìÖ Fecha: ${new Date().toLocaleDateString('es-ES')}\n\n`;
            resumen += `üìà AN√ÅLISIS DETALLADO POR CRITERIO:\n`;
            resumen += `${'‚ïê'.repeat(45)}\n`;
            
            Object.keys(evaluationResults).forEach((criterio, index) => {
                const resultado = evaluationResults[criterio];
                const config = criterios[criterio];
                
                let nivel = '';
                if (resultado.puntuacion >= 4.5) nivel = 'üåü EXCELENTE';
                else if (resultado.puntuacion >= 3.5) nivel = '‚úÖ BUENO';
                else if (resultado.puntuacion >= 2.5) nivel = '‚ö†Ô∏è REGULAR';
                else nivel = 'üîß DEFICIENTE';
                
                resumen += `\n${index + 1}. ${config.nombre.toUpperCase()}\n`;
                resumen += `   üìä Puntuaci√≥n: ${resultado.puntuacion.toFixed(1)}/5.0 ${nivel}\n`;
                resumen += `   üí° Recomendaci√≥n clave: ${resultado.recomendaciones}\n`;
                
                if (criterio !== 'redaccion' && resultado.categoriasCubiertas !== undefined) {
                    const cobertura = (resultado.categoriasCubiertas/resultado.totalCategorias*100).toFixed(0);
                    resumen += `   üéØ Cobertura tem√°tica: ${cobertura}%\n`;
                }
                resumen += `   ${'-'.repeat(40)}\n`;
            });
            
            resumen += `\nüéØ CONCLUSI√ìN GENERAL:\n`;
            resumen += interpretacion.replace(/\n/g, ' ');
            resumen += `\n\nüîí Evaluaci√≥n generada por sistema autom√°tico avanzado`;
            resumen += `\n‚è∞ ${new Date().toLocaleString('es-ES')}`;
            
            navigator.clipboard.writeText(resumen).then(() => {
                mostrarNotificacion('üìã Resumen completo copiado al portapapeles', 'success');
            }).catch(err => {
                mostrarNotificacion('Error al copiar el resumen', 'error');
            });
        }

        function reiniciar() {
            // Limpiar formulario
            document.getElementById('nombreCompleto').value = '';
            document.getElementById('proyectoPDF').value = '';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('analyzeBtn').textContent = 'üîç Analizar Proyecto';
            
            // Ocultar resultados
            document.getElementById('results').style.display = 'none';
            document.getElementById('totalScoreSection').style.display = 'none';
            document.getElementById('finalButtons').style.display = 'none';
            
            // Limpiar datos
            pdfText = '';
            evaluationResults = {};
            
            mostrarNotificacion('‚ú® Formulario reiniciado - Listo para nueva evaluaci√≥n', 'success');
        }

        function mostrarNotificacion(mensaje, tipo = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = mensaje;
            notification.className = `notification ${tipo === 'error' ? 'error' : ''}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Validaci√≥n en tiempo real del nombre
        document.getElementById('nombreCompleto').addEventListener('input', function() {
            const hasName = this.value.trim().length > 0;
            const hasFile = document.getElementById('proyectoPDF').files.length > 0;
            document.getElementById('analyzeBtn').disabled = !(hasName && hasFile);
        });
    </script>
</body>
</html>